---
import Layout from "../../layouts/Layout.astro";
import { getTrips } from "../viajes/trip.api";

const trips = await getTrips();
---

<Layout
  title="Viajes | Pablo Dive"
  description="Viajes y expediciones relacionados con el submarinismo"
>
  <div
    class="min-h-screen flex flex-col justify-center overflow-hidden relative"
  >
    <div class="absolute top-12 left-12 z-10">
      <h1
        class="text-base-content text-4xl md:text-6xl font-bold tracking-tighter"
      >
        EXPEDICIONES <span class="text-cyan-500">2025</span>
      </h1>
    </div>

    <!-- Horizontal Scroll Container -->
    <div
      id="slider-container"
      class="overflow-x-auto flex gap-8 px-12 py-20 snap-x snap-mandatory scrollbar-hide items-center h-screen cursor-grab active:cursor-grabbing select-none"
    >
      <!-- Intro Card -->
      <div
        class="snap-center shrink-0 w-[300px] md:w-[400px] text-white flex flex-col justify-center pointer-events-none"
      >
        <p class="text-xl md:text-3xl leading-relaxed text-slate-700">
          "El mundo es un libro y aquellos que no viajan solo leen una página."
        </p>
      </div>

      {
        trips.map((trip) => (
          <a
            href={`/trips/${trip.slug}`}
            class="snap-center shrink-0 w-[80vw] md:w-[600px] h-[60vh] relative rounded-3xl overflow-hidden group cursor-pointer trip-card"
            ondragstart="return false"
          >
            <img
              src={trip.image.url}
              alt={trip.title}
              class="w-full h-full object-cover group-hover:transition-all duration-700 pointer-events-none"
            />
            <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent pointer-events-none" />

            <div class="absolute bottom-0 left-0 w-full p-12 pointer-events-none">
              <div class="relative z-10 transform translate-y-4 group-hover:translate-y-0 transition-transform duration-500">
                <div class="flex items-center gap-4 mb-4">
                  <span class="px-3 py-1 bg-cyan-700 text-black text-xs font-bold uppercase rounded-full">
                    {trip.destination}
                  </span>
                  <span class="text-slate-200 text-sm uppercase tracking-widset drop-shadow-md">
                    {trip.duration} Días
                  </span>
                </div>
                <h2 class="text-4xl md:text-6xl font-bold text-white mb-4 leading-none drop-shadow-lg">
                  {trip.title}
                </h2>
              </div>
            </div>
          </a>
        ))
      }

      <!-- Spacer -->
      <div class="w-12 shrink-0"></div>
    </div>
  </div>
</Layout>

<style>
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>

<script>
  const slider = document.getElementById("slider-container");
  let isDown = false;
  let startX: number;
  let scrollLeft: number;

  if (slider) {
    slider.addEventListener("mousedown", (e) => {
      isDown = true;
      slider.classList.add("active");
      // Disable snap during drag for smooth movement
      slider.style.scrollSnapType = "none";
      slider.style.cursor = "grabbing";
      startX = e.pageX - slider.offsetLeft;
      scrollLeft = slider.scrollLeft;
    });

    const stopDrag = () => {
      if (!isDown) return;
      isDown = false;
      slider.classList.remove("active");
      // Re-enable snap after drag
      slider.style.scrollSnapType = "x mandatory";
      slider.style.cursor = "grab";
    };

    slider.addEventListener("mouseleave", stopDrag);
    slider.addEventListener("mouseup", stopDrag);

    slider.addEventListener("mousemove", (e) => {
      if (!isDown) return;
      e.preventDefault();
      const x = e.pageX - slider.offsetLeft;
      // 1:1 movement for natural touch-like feel
      const walk = x - startX;
      slider.scrollLeft = scrollLeft - walk;
    });
    const leftBtn = document.getElementById("slide-left");
    const rightBtn = document.getElementById("slide-right");

    if (leftBtn) {
      leftBtn.addEventListener("click", () => {
        slider.scrollBy({ left: -window.innerWidth * 0.6, behavior: "smooth" });
      });
    }

    if (rightBtn) {
      rightBtn.addEventListener("click", () => {
        slider.scrollBy({ left: window.innerWidth * 0.6, behavior: "smooth" });
      });
    }
  }
</script>
